libraries:
    scraps:
        repository: git@github.com:bittorrent/scraps.git
        commit: 506b74ac7ebfe233255cf3165717a552c1da8331
        project:
            type: boostbuild
            pre-build: ./build-deps --needy-target-args='-t {{ platform }}:{{ architecture }}' --needy-satisfy-args='--android-toolchain={{ env['ANDROID_TOOLCHAIN'] }}' --configure
    boost-build:
        download: https://github.com/boostorg/build/archive/2016.03.tar.gz
        checksum: 0e6936337c25fc87d2aff8ea6c63019e9c1e319a
        project:
            build-steps:
                - ./bootstrap.sh
                - ./b2 install --prefix={build_directory}
    jshackle:
        repository: git@github.com:bittorrent/jshackle.git
        commit: d9f1450a35f166048bb90505f33be82bab28bacb
        project:
            header-directory: include
    gas-preprocessor:
        repository: https://github.com/libjpeg-turbo/gas-preprocessor.git
        commit: 4338df436a20ad4d28c7cd37852323e902f1144c
        project:
            build-steps:
                - mkdir -p {build_directory}/bin/
                - cp gas-preprocessor.pl {build_directory}/bin/
    nasm:
        download: 'http://www.nasm.us/pub/nasm/releasebuilds/2.11.06/nasm-2.11.06.tar.bz2'
        checksum: 'eaad6f440d3f8d2172d7fd93bed224d4052b904f'
    libjpeg-turbo:
        download: https://s3.amazonaws.com/live-dev-deps/libjpeg-turbo-1.4.90.tar.gz
        checksum: 62af89207d08252a1d8c4997ae50e11f4195ed74
        dependencies:
            - gas-preprocessor
            {% if platform == host_platform %}
            - nasm
            {% endif %}
        project:
            environment:
                PATH: '{{ build_directory('gas-preprocessor') }}/bin:{{build_directory('nasm') ~ '/bin:' if platform == host_platform}}{current}'
                CCAS: {{'arm-linux-androideabi-as' if platform == 'android' else 'nasm'}}
            {% if platform == 'iossimulator' and architecture == 'i386' %}
            configure-args: --host=i686-apple-darwin
            {% endif %}
            post-build:
                # TODO: either only build the static version or find a way to
                # specify static in the b2 files.
                - rm -f {build_directory}/lib/*.dylib
                - rm -f {build_directory}/lib/*.so
                - printf "This software is based in part on the work of the Independent JPEG Group.\n\n" > license
                - sed -nE '/\*\//q; /^\/\*/d; s/^ *\* ?//p' turbojpeg.h >> license
                - xxd -i license {build_directory}/include/tjlicense.c
    libpng:
        download: https://s3.amazonaws.com/live-dev-deps/libpng-1.6.23.tar.gz
        checksum: 26c68ff9905dbeb85d1cc9c673726e9e0669e7a0
        project:
            configure-args:
                - --disable-shared
        {% if architecture == 'armv7' or architecture == 'arm64' %}
                - --enable-arm-neon=yes
        {% endif %}
            post-build:
                - xxd -i LICENSE {build_directory}/include/libpng16/pnglicense.c
    sdl2:
        repository: git@github.com:bittorrent/SDL.git
        commit: e6c442fb49dfc16979a31d6e947b57e47705bb5f
        project:
        {% if platform in ['ios', 'tvos', 'iossimulator', 'tvossimulator'] %}
            xcode-project: Xcode-iOS/SDL/SDL.xcodeproj
            xcode-target: {{'libSDL-tv' if platform in ['tvos', 'tvossimulator'] else 'libSDL' }}
            # When installed from xcode, the headers are in `include` when we
            # want them to match the other builds: `include/SDL2`
            post-build:
                - mv {build_directory}/include {build_directory}/SDL2
                - mkdir {build_directory}/include
                - mv {build_directory}/SDL2 {build_directory}/include/SDL2
                # private SDL headers used by the viewer
                - mkdir {build_directory}/include/SDL2/private-headers
                - cp src/video/uikit/SDL_uikitappdelegate.h {build_directory}/include/SDL2/private-headers/
        {% else %}
            configure-args:
                - --disable-shared
                - --disable-video-x11
                - --disable-video-opengles1
                {% if platform == 'android' %}
                - --host=arm-linux-androideabi
                {% endif %}
            post-build:
        {% endif %}
                - xxd -i COPYING.txt {build_directory}/include/SDL2/SDL_license.c
        {% if platform == 'android' %}
                - mkdir -p {build_directory}/share/sdl2
                - cp -R android-project {build_directory}/share/sdl2
        {% endif %}
    googletest:
        repository: git@github.com:google/googletest.git
        commit: 43359642a1c16ad3f4fc575c7edd0cb935810815
        project:
            build-steps:
                - cp -R googletest/include {build_directory}
                - $CXX {{ '-stdlib=libc++' if platform != 'android' }} -isystem googletest/include -I googletest -c googletest/src/gtest-all.cc  -o googletest/src/gtest-all.o
                - $CXX {{ '-stdlib=libc++' if platform != 'android' }} -isystem googletest/include -I googletest -c googletest/src/gtest_main.cc -o googletest/src/gtest_main.o
                - ar -rv {build_directory}/lib/libgtest.a      googletest/src/gtest-all.o
                - ar -rv {build_directory}/lib/libgtest_main.a googletest/src/gtest_main.o
    utf8:
        directory: third-party/utf8
        project:
            post-build:
                - xxd -i LICENSE {build_directory}/include/utf8/license.c
